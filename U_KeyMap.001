AK155 07-06-2004 <U_KeyMap.pas> U_KeyMap.001

    Hабор встроенных кодировок (то есть таких, которые перелистываются
по F8)  всегда включает не менее двух (обозначаемых в рамке окна
"DOS" и "WIN"). Под Win32 это кодировки OEM и ANSI, их легко запросить
у системы. Под OS/2 кодировка DOS - это текущая кодовая страница,
а кодировку WIN надо задавать при помощи ini-переменной
(под Win32 она не нужна):

WinCodePage=1251

  В Warp 3 появилось со старыми факсами (до 26-го кажется) нет работы с
кодовыми страницами, поэтому такой вариант не пройдёт. В этом случае можно
задать вместо номера CP имя xlt-файла (он задаёт перекодировку из виндовой
в текущую, то есть первый символ - виндовый код, второй - текущий и т.д.).

WinCodePage=win866.xlt

    Для задания дополнительных встроенных кодировок вводим ini-переменную
примерно такого вида:

CodeTables= KOI:878 MAC:mac.xlt

    Тут каждая кодировка задаётся двумя элементами, соединёнными двоеточием.
Первый элемент - обозначение для показа в рамке (буквы допускаются только
большие английские), второй элемент - либо номер кодовой страницы,
установленной в системе, либо имя xlt-файла, задающего перекодировку из
этой кодировки в кодировку DOS.

    Для задания таблицы перекодировки текста, введённого не на той
раскладке, служит ini-переменная

KbdToggleLayot=kbd66.xlt

    Файл перекодировки для клавиатуры - обычный xlt-файл, только
несколько по-другому вводимый (из него строится не две таблицы - "туда"
и "обратно", а одна "туда-сюда").

    Каждая кодировка задаётся тремя таблицами TXlat, объединёнными в
массив TXLatCP. Полуфиктивная тройка для кодировки DOS и вполне нормальная
тройка для кодировки WIN зарезервированы статически, для остальных
встроенных кодировок память выделяется динамически при обработке dn.ini.

    Заполнение такой тройки всегда начинается с заполнения таблицы ToAscii
(она или запрашивается у системы или сроится по xlt-файлу). А затем на
её основе строятся обе обратные таблицы.

    Таблица перекодировки из некой CP в ASCII с обновременным переводом на
верхний регистр (ToUpAscii) используется при регистронезависимом поиске.
Образец поиска (в ASCII) заранее однократно переводится на верхний регистр,
а строки поиска перекодируются по таблице ToUpAscii.

